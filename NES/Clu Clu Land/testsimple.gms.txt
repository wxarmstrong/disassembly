$ontext

   MIN-MAX MULTIPLE TRAVELLING SALESMAN PROBLEM

$offtext

$set startcity i1

scalar
   m 'number of salesman' /2/
   p 'number of cities to visit' /67/
;

sets
   i /i1*i67/
;
alias (i,j);

sets
   k / 1, 2 /
;

table c(i,j) 'distance matrix (KM)'
       i1   i2   i3   i4   i5   i6   i7   i8   i9  i10  i11  i12  i13  i14  i15  i16  i17  i18  i19  i20  i21  i22  i23  i24  i25  i26  i27  i28  i29  i30  i31  i32  i33  i34  i35  i36  i37  i38  i39  i40  i41  i42  i43  i44  i45  i46  i47  i48  i49  i50  i51  i52  i53  i54  i55  i56  i57  i58  i59  i60  i61  i62  i63  i64  i65  i66  i67 
i1           1    1                                                                                                                                                                                                                                                                                                                                 
i2                   105  107  103  104  106  104  105  107  106  108  106  109  104  105  105  105  106  106  107  107  107  108  106  108  105  111  105  106  106  106  106  107  107  108  109  110  111  111  112  112  112  112  113  107  107  108  108  108  109  109  110  110  111  111  112  112  112  113  113  109  110  111  112  113 
i3                   107  105  109  108  106  106  107  105  106  104  104  103  108  107  107  107  106  106  105  105  105  104  108  106  111  105  113  112  112  112  112  111  111  110  109  108  107  107  106  106  106  106  105  113  113  112  112  112  111  111  110  110  109  109  108  108  108  107  107  113  112  111  110  109 
i4      1                 103  103  103  103    1  103  103  104  104  104  105  104  104  104  104  104  104  105  105  105  106  106  106  107  109  109  108  108  108  108  107  107  107  107  108  109  109  110  110  110  110  111  109  109  108  109  108  109  108  109  108  109  109  110  110  110  111  111  110  110  110  110  111 
i5      1            103       105  104  104  104  103  103  103  103    1  103  106  105  105  105  104  104  104  104  104  104  106  106  109  107  111  110  110  110  110  109  109  108  107  107  107  107  108  108  108  108  109  111  111  110  110  110  109  109  109  108  109  108  108  109  108  109  109  111  110  110  110  110 
i6      1            103  105       104    1  104  105  105  106  106  106  107  102  103  105  103  104  106  105  107  105  108  104  106  105  109  107  106  106  106  106  105  105  106  107  108  109  109  110  110  110  110  111  107  107  106  108  106  107  107  108  108  109  109  110  110  110  111  111  108  108  109  110  111 
i7      1            103  104  104       101  101  104    1  105  105  105  106  103  102  102  102  103  105  104  106  104  107  105  105  106  108  108  107  107  107  107  106  106  105  106  107  108  108  109  109  109  109  110  108  108  107  107  107  108  106  107  107  108  108  109  109  109  110  110  108  108  108  109  110 
i8      1            103  104    1  101       101  102  104  103  105  103  106  105  102  102  102  103  103  104  104  104  105  105  105  106  108  108  107  107  107  107  106  106  105  106  107  108  108  109  109  109  109  110  108  108  107  107  107  108  106  107  107  108  108  109  109  109  110  110  108  108  108  109  110 
i9      1              1  104  104  101  101       102  104  103  105  103  106  103  102  102  102  103  103  104  104  104  105  105  105  106  108  108  107  107  107  107  106  106  105  106  107  108  108  109  109  109  109  110  108  108  107  107  107  108  106  107  107  108  108  109  109  109  110  110  108  108  108  109  110 
i10     1            103  103  105  104  102  102       101  104    1  104  105  104  103  103  103  102  102  103  105  103  106  104  104  107  107  109  108  108  108  108  107  107  106  105  106  107  107  108  108  108  108  109  109  109  108  108  108  107  107  108  106  107  107  108  108  108  109  109  109  108  108  108  109 
i11     1            103  103  105    1  104  104  101       102  104  102  105  106  105  103  103  102  102  103  103  103  104  104  104  107  107  109  108  108  108  108  107  107  106  105  106  107  107  108  108  108  108  109  109  109  108  108  108  107  107  108  106  107  107  108  108  108  109  109  109  108  108  108  109 
i12     1            104  103  106  105  103  103  104  102       101  101    1  105  104  104  104  103  103  102  102  102  105  105  105  108  106  110  109  109  109  109  108  108  107  106  105  106  106  107  107  107  107  108  110  110  109  109  109  108  108  107  107  108  106  107  107  107  108  108  110  109  108  108  108 
i13     1            104  103  106  105  105  105    1  104  101       101  104  107  106  104  104  105  103  102  102  102  103  105  105  108  106  110  109  109  109  109  108  108  107  106  105  106  106  107  107  107  107  108  110  110  109  109  109  108  108  107  107  108  106  107  107  107  108  108  110  109  108  108  108 
i14     1            104    1  106  105  103  103  104  102  101  101       104  105  104  104  104  103  103  102  102  102  103  105  105  108  106  110  109  109  109  109  108  108  107  106  105  106  106  107  107  107  107  108  110  110  109  109  109  108  108  107  107  108  106  107  107  107  108  108  110  109  108  108  108 
i15     1            105  103  107  106  106  106  105  105    1  104  104       108  107  105  105  106  104  105  103  103  102  106  104  109  105  111  110  110  110  110  109  109  108  107  106  105  105  106  106  106  106  107  111  111  110  110  110  109  109  108  108  107  107  106  108  106  107  107  111  110  109  108  108 
i16     1            104  106  102  103  105  103  104  106  105  107  105  108       104    1  104  105  105  106  106  106  107  103  105  104  108  106  105  105  105  105  104  104  105  106  107  108  108  109  109  109  109  110  106  106  105  107  105  106  106  107  107  108  108  109  109  109  110  110  107  107  108  109  110 
i17     1            104  105  103  102  102  102  103  105  104  106  104  107  104       101  101  104    1  105  105  105  106  104  104  105  107  107  106  106  106  106  105  105  104  105  106  107  107  108  108  108  108  109  107  107  106  106  106  107  105  106  106  107  107  108  108  108  109  109  107  107  107  108  109 
i18     1            104  105  105  102  102  102  103  103  104  104  104  105    1  101       101  102  104  103  105  103  106  104  104  105  107  107  106  106  106  106  105  105  104  105  106  107  107  108  108  108  108  109  107  107  106  106  106  107  105  106  106  107  107  108  108  108  109  109  107  107  107  108  109 
i19     1            104  105  103  102  102  102  103  103  104  104  104  105  104  101  101       102  104  103  105  103  106    1  104  105  107  107  106  106  106  106  105  105  106  105  106  107  107  108  108  108  108  109  107  107  106  108  106  107  107  108  106  107  107  108  108  108  109  109  108  108  108  108  109 
i20     1            104  104  104  103  103  103  102  102  103  105  103  106  105  104  102  102       101  104    1  104  105  103  103  106  106  108  107  107  107  107  106  106  105  104  105  106  106  107  107  107  107  108  108  108  107  107  107  106  106  107  105  106  106  107  107  107  108  108  108  107  107  107  108 
i21     1            104  104  106  105  103  103  102  102  103  103  103  104  105    1  104  104  101       102  104  102  105  103  103  106  106  108  107  107  107  107  106  106  105  104  105  106  106  107  107  107  107  108  108  108  107  107  107  106  106  107  105  106  106  107  107  107  108  108  108  107  107  107  108 
i22     1            105  104  105  104  104  104  103  103  102  102  102  105  106  105  103  103  104  102       101  101    1  104  104  107  105  109  108  108  108  108  107  107  106  105  104  105  105  106  106  106  106  107  109  109  108  108  108  107  107  106  106  107  105  106  106  106  107  107  109  108  107  107  107 
i23     1            105  104  107  106  104  104  105  103  102  102  102  103  106  105  105  105    1  104  101       101  104  104  104  107  105  109  108  108  108  108  107  107  106  105  104  105  105  106  106  106  106  107  109  109  108  108  108  107  107  106  106  107  105  106  106  106  107  107  109  108  107  107  107 
i24     1            105  104  105  104  104  104  103  103  102  102  102  103  106  105  103  103  104  102  101  101       104  104    1  107  105  109  108  108  108  108  107  107  106  105  106  105  105  106  106  106  106  107  109  109  108  108  108  107  107  108  106  107  107  106  108  106  107  107  109  108  108  108  108 
i25     1            106  104  108  107  105  105  106  104  105  103  103  102  107  106  106  106  105  105    1  104  104       105  103  108  104  110  109  109  109  109  108  108  107  106  105  104  104  105  105  105  105  106  110  110  109  109  109  108  108  107  107  106  106  105  107  105  106  106  110  109  108  107  107 
i26     1            106  106  104  105  105  105  104  104  105  105  105  106  103  104  104    1  103  103  104  104  104  105       103  104  106  106  105  105  105  105  104  104  103  104  105  106  106  107  107  107  107  108  106  106  105  105  105  106  104  105  105  106  106  107  107  107  108  108  106  106  106  107  108 
i27     1            106  106  106  105  105  105  104  104  105  105  105  104  105  104  104  104  103  103  104  104    1  103  103       106  104  108  107  107  107  107  106  106  105  104  103  104  104  105  105  105  105  106  108  108  107  107  107  106  106  105  105  106  104  105  105  105  106  106  108  107  106  106  106 
i28     1            107  109  105  106  106  106  107  107  108  108  108  109  104  105  105  105  106  106  107  107  107  108  104  106       107  103  103  103    1  103  103  103  104  105  106  107  107  108  108  108  108  109  104  105  104  105  104  105  105  106  106  107  107  108  108  108  109  109  106  106  107  108  109 
i29     1            109  107  109  108  108  108  107  107  106  106  106  105  108  107  107  107  106  106  105  105  105  104  106  104  107       109  108  108  108  108  107  107  106  105  104  103  103  103  103    1  103  103  109  109  108  108  108  107  107  106  106  105  105  104  105  104  104  105  109  108  107  106  106 
i30     1            109  111  107  108  108  108  109  109  110  110  110  111  106  107  107  107  108  108  109  109  109  110  106  108  103  109       103    1  103  103  105  104  105  106  107  108  108  109  110  109  109  111  103  103  105  104  104  105  105  106  106  107  107  108  108  108  110  109  105  106  107  108  109 
i31     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107  103  108  103       101  101  101    1  104  105  106  107  108  108  109  109  109  109  110  102  104  105  103  103  104  104  105  105  106  106  107  107  107  110  108  104  105  106  107  108 
i32     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107  103  108    1  101       101  101  104  102  103  104  105  106  106  107  109  107  107  109  102  104  103  103  103  104  104  105  105  106  106  107  107  107  108  108  104  105  106  107  108 
i33     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107    1  108  103  101  101       101  104  102  103  104  105  106  106  107  109  107  107  109  102  104  103  103  103  104  104  105  105  106  106  107  107  107  108  108  104  105  106  107  108 
i34     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107  103  108  103  101  101  101       104  102  103  104  105  106  106  107  109  107  107  109  104    1  103  105  103  104  104  105  105  106  106  107  107  107  108  108  105  105  106  107  108 
i35     1            107  109  105  106  106  106  107  107  108  108  108  109  104  105  105  105  106  106  107  107  107  108  104  106  103  107  105    1  104  104  104       101  102  103  104  105  105  106  108  106  106  108  105  103  102  104  102  103  103  104  104  105  105  106  106  106  107  107  104  104  105  106  107 
i36     1            107  109  105  106  106  106  107  107  108  108  108  109  104  105  105  105  106  106  107  107  107  108  104  106  103  107  104  104  102  102  102  101       102  103  104  105  105  106  108  106  106  108  103  105  104    1  104  105  103  104  104  105  105  106  106  106  107  107  105  105  105  106  107 
i37     1            107  108  106  105  105  105  106  106  107  107  107  108  105  104  104  106  105  105  106  106  106  107  103  105  104  106  105  105  103  103  103  102  102       102  103  104  104  105  107  105  105  107  104  104  103  105  103    1  104  105  103  104  104  105  105  105  106  106  105  105  105  105  106 
i38     1            107  107  107  106  106  106  105  105  106  106  106  107  106  105  105  105  104  104  105  105  105  106  104  104  105  105  106  106  104  104  104  103  103  102       102  103  103  104  106  104  104  106  105  105  104  104  104  105  103    1  104  105  103  104  104  104  105  105  105  105  105  105  105 
i39     1            108  107  108  107  107  107  106  106  105  105  105  106  107  106  106  106  105  105  104  104  106  105  105  103  106  104  107  107  105  105  105  104  104  103  102       102  102  103  105  103  103  105  106  106  105  105  105  104  104  105  103    1  104  103  105  103  104  104  106  105  105  105  105 
i40     1            109  107  109  108  108  108  107  107  106  106  106  105  108  107  107  107  106  106  105  105  105  104  106  104  107  103  108  108  106  106  106  105  105  104  103  102       101  104    1  104  104  105  107  107  106  106  106  105  105  104  104  103  103  102  104  102  105  103  107  106  105  104  104 
i41     1            109  107  109  108  108  108  107  107  106  106  106  105  108  107  107  107  106  106  105  105  105  104  106  104  107  103  108  108  106  106  106  105  105  104  103  102  101       102  104  102  102  104  107  107  106  106  106  105  105  104  104  105  103  104    1  104  103  105  107  106  105  105  105 
i42     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108  103  109  109  107  107  107  106  106  105  104  103  104  102       101  101  101    1  108  108  107  107  107  106  106  105  105  104  104  103  103  103  102  104  108  107  106  105  104 
i43     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108  103  110  109  109  109  109  108  108  107  106  105    1  104  101       101  101  103  110  108  107  107  107  106  106  105  105  104  104  105  103  103  102  104  108  107  106  105  104 
i44     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108    1  109  109  107  107  107  106  106  105  104  103  104  102  101  101       101  103  108  108  107  107  107  106  106  105  105  104  104  103  103  103  102  104  108  107  106  105  104 
i45     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108  103  109  109  107  107  107  106  106  105  104  103  104  102  101  101  101       103  108  108  107  107  107  106  106  105  105  104  104  103  105  103  104    1  108  107  106  105  105 
i46     1            111  109  111  110  110  110  109  109  108  108  108  107  110  109  109  109  108  108  107  107  107  106  108  106  109  103  111  110  109  109  109  108  108  107  106  105  105  104    1  103  103  103       110  109  108  108  108  107  107  106  106  105  105  105  104  104  103  103  109  108  107  106  105 
i47     1            109  111  107  108  108  108  109  109  110  110  110  111  106  107  107  107  108  108  109  109  109  110  106  108  104  109  103  102  102  102  104  105  103  104  105  106  107  107  108  110  108  108  110       101    1  104  104  105  105  106  106  107  107  108  108  108  109  109  103  104  105  106  107 
i48     1            109  111  107  108  108  108  109  109  110  110  110  111  106  107  107  107  108  108  109  109  109  110  106  108  105  109  103  104  104  104    1  103  105  104  105  106  107  107  108  108  108  108  109  101       104  102  102  103  103  104  104  105  105  106  106  106  109  107  103  104  105  106  107 
i49     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107  104  108  105  105  103  103  103  102  104  103  104  105  106  106  107  107  107  107  108    1  104       101  101  102  102  103  103  104  104  105  105  105  108  106  103  103  104  105  106 
i50     1            109  110  108  107  107  107  108  108  109  109  109  110  107  106  106  108  107  107  108  108  108  109  105  107  105  108  104  103  103  103  105  104    1  105  104  105  106  106  107  107  107  107  108  104  102  101       101  102  102  103  103  104  104  105  105  105  108  106  103  103  104  105  106 
i51     1            108  110  106  107  107  107  108  108  109  109  109  110  105  106  106  106  107  107  108  108  108  109  105  107  104  108  104  103  103  103  103  102  104  103  104  105  106  106  107  107  107  107  108  104  102  101  101       102  102  103  103  104  104  105  105  105  108  106    1  104  104  105  106 
i52     1            109  109  107  108  108  108  107  107  108  108  108  109  106  107  107  107  106  106  107  107  107  108  106  106  105  107  105  104  104  104  104  103  105    1  105  104  105  105  106  106  106  106  107  105  103  102  102  102       101  102  102  103  103  104  104  104  107  105  103  103  103  104  105 
i53     1            108  109  107  106  106  106  107  107  108  108  108  109  106  105  105  107  106  106  107  107  107  108  104  106  105  107  105  104  104  104  104  103  103  104  103  104  105  105  106  106  106  106  107  105  103  102  102  102  101       102  102  103  103  104  104  104  107  105  104    1  104  104  105 
i54     1            109  109  108  107  107  107  108  108  107  107  107  108  107  106  106  108  107  107  106  106  108  107  105  105  106  106  106  105  105  105  105  104  104  105    1  105  104  104  105  105  105  105  106  106  104  103  103  103  102  102       101  102  102  103  103  103  106  104  104  103  103  103  104 
i55     1            108  108  108  107  107  107  106  106  107  107  107  108  107  106  106  106  105  105  106  106  106  107  105  105  106  106  106  105  105  105  105  104  104  103  104  103  104  104  105  105  105  105  106  106  104  103  103  103  102  102  101       102  102  103  103  103  106  104  104  104    1  104  104 
i56     1            109  109  109  108  108  108  107  107  108  108  108  107  108  107  107  107  106  106  107  107  107  106  106  106  107  105  107  106  106  106  106  105  105  104  105    1  103  105  104  104  104  104  105  107  105  104  104  104  103  103  102  102       101  102  102  102  105  103  105  104  103  103  103 
i57     1            109  108  109  108  108  108  107  107  106  106  106  107  108  107  107  107  106  106  105  105  107  106  106  104  107  105  107  106  106  106  106  105  105  104  103  104  103  103  104  104  104  104  105  107  105  104  104  104  103  103  102  102  101       102  102  102  105  103  105  104  104    1  104 
i58     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108  104  108  107  107  107  107  106  106  105  104  103  102  104  103  105  103  103  105  108  106  105  105  105  104  104  103  103  102  102       101  101    1  104  106  105  104  103  103 
i59     1            110  109  110  109  109  109  108  108  107  107  107  108  109  108  108  108  107  107  106  106  108  107  107  105  108  105  108  107  107  107  107  106  106  105  104  105  104    1  103  103  103  105  104  108  106  105  105  105  104  104  103  103  102  102  101       101  104  102  106  105  104  103  103 
i60     1            110  108  110  109  109  109  108  108  107  107  107  106  109  108  108  108  107  107  106  106  106  105  107  105  108  104  108  107  107  107  107  106  106  105  104  103  102  104  103  103  103  103  104  108  106  105  105  105  104  104  103  103  102  102  101  101       104  102  106  105  104  104    1 
i61     1            111  109  111  110  110  110  109  109  108  108  108  107  110  109  109  109  108  108  107  107  107  106  108  106  109  104  110  110  108  108  108  107  107  106  105  104  105  103  102  102  102  104  103  109  109  108  108  108  107  107  106  106  105  105    1  104  104       101  107  106  105  104  103 
i62     1            111  109  111  110  110  110  109  109  108  108  108  107  110  109  109  109  108  108  107  107  107  106  108  106  109  105  109  108  108  108  108  107  107  106  105  104  103  105  104  104  104    1  103  109  107  106  106  106  105  105  104  104  103  103  104  102  102  101       107  106  105  104  103 
i63     1            110  111  108  108  108  108  109  109  110  110  110  111  107  107  107  108  108  108  109  109  109  110  106  108  106  109  105  104  104  104  105  104  105  105  105  106  107  107  108  108  108  108  109  103  103  103  103    1  103  104  104  104  105  105  106  106  106  107  107       102  103  104  105 
i64     1            110  110  108  108  108  108  108  108  109  109  109  110  107  107  107  108  107  107  108  108  108  109  106  107  106  108  106  105  105  105  105  104  105  105  105  105  106  106  107  107  107  107  108  104  104  103  103  104  103    1  103  104  104  104  105  105  105  106  106  102       102  103  104 
i65     1            110  110  109  108  108  108  108  108  108  108  108  109  108  107  107  108  107  107  107  107  108  108  106  106  107  107  107  106  106  106  106  105  105  105  105  105  105  105  106  106  106  106  107  105  105  104  104  104  103  104  103    1  103  104  104  104  104  105  105  103  102       102  103 
i66     1            110  110  110  109  109  109  108  108  108  108  108  108  109  108  108  108  107  107  107  107  108  107  107  106  108  106  108  107  107  107  107  106  106  105  105  105  104  105  105  105  105  105  106  106  106  105  105  105  104  104  103  104  103    1  103  103  104  104  104  104  103  102       102 
i67     1            111  110  111  110  110  110  109  109  108  108  108  108  110  109  109  109  108  108  107  107  108  107  108  106  109  106  109  108  108  108  108  107  107  106  105  105  104  105  104  104  104  105  105  107  107  106  106  106  105  105  104  104  103  104  103  103    1  103  103  105  104  103  102      
;

set arcs(i,j);
arcs(i,j)$c(i,j) = yes;

set i0(i) /%startcity%/;

set i2(i);
i2(i)$(not i0(i)) = yes;

scalar n 'number of nodes';
n = card(i);

binary variables x(i,j,k);
positive variables u(i);
variable q;

equations
   start(k)    'each salesperson exits the origin exactly once'
   end(k)      'each salesperson enters the origin exactly once'
   assign1(i)  'each city is exited exactly once'
   assign2(j)  'each city is entered exactly once'
   sec(i,j)    'subtour elimination (all tours begin/end at origin)'
   sep(j,k)    'each city is entered/exited by the same salesperson'
   subcost(k)
;

start(k).. sum(i2(j), x('%startcity%',j,k)) =e= 1;

end(k).. sum(i2(i), x(i,'%startcity%',k)) =e= 1;

assign1(i2(i)).. sum((arcs(i,j),k), x(i,j,k)) =e= 1;

assign2(i2(j)).. sum((arcs(i,j),k), x(i,j,k)) =e= 1;

sec(arcs(i,j))$(i2(i) and i2(j)).. u(i) - u(j) + p*sum(k, x(i,j,k)) =L= p-1;

sep(i2(j),k).. sum(arcs(i,j), x(i,j,k)) =e= sum(arcs(j,i), x(j,i,k));

subcost(k).. sum(arcs, c(arcs)*x(arcs,k)) - 2 - 101*( sum(arcs, x(arcs,k)) - 2)/2 =L= q;

option optcr=0;
option reslim=28200;

* use parallel MIP
option threads=8;

model mtsp/all/;
solve mtsp minimizing q using mip;